# Задание 3. Решение кейса с репликацией

В проекте есть 2 шарда + 3 реплики в каждом шарде, 3 роутера и 3 конфига. Настройки представлены в compose.yaml

## Как запустить

### Запускаем mongodb и приложение

```shell
docker compose up -d
```

### Запустить настройку БД, наполнение документами. Скрипт:

```shell
./scripts/init.sh
```

В скрипте будут настроены роутеры, репликасеты шардов (3 инстанса на каждый шард), конфиги. В конце выполнения скрипта будет показны результаты тестов: наличие реплик (что является primary, а что secondary для шардов), выведено количество документов в шардах, общее количество документов в БД, проверен доступ к API. Пример ответов:

```shell
...
[✔] Шарды добавлены и коллекция зашардирована
[...] Проверка количества документов в базе
Всего документов: 1000
[✔] Документы успешно подсчитаны
[...] Проверка shard1a
Количество документов в shard1a: 492
[✔] Shard1a проверен
[...] Проверка shard2a
Количество документов в shard2a: 508
[✔] Shard2a проверен
[...] Проверка доступности методов в http://localhost:8080/docs
Ответ от сервера: {"status":"OK","mongo_db":"somedb","items_count":1000}
[✔] Методы доступны, данные с БД можно получить
[...] Проверка реплик в первом шарде
Информация по первому шарду: shard1a:27018 — PRIMARY
shard1b:27018 — SECONDARY
shard1c:27018 — SECONDARY
[✔] ОК
[...] Проверка реплик во втором шарде
Информация по второму шарду: shard2a:27019 — PRIMARY
shard2b:27019 — SECONDARY
shard2c:27019 — SECONDARY
[✔] ОК
[✔] Финиш
```

Также дополнительно автоматизирована проверка доступности API на <server>/docs. Пример ответа

```
[...] Проверка доступности методов в http://localhost:8080/docs
Ответ от сервера: {"status":"OK","mongo_db":"somedb","items_count":1000}
[✔] Методы доступны, данные с БД можно получить
```

## Проверка эндпойнтов

Узнать белый ip виртуальной машины

```shell
curl --silent http://ifconfig.me
```

Доступ к API-документации:

```
http://<ip виртуальной машины>:8080/docs
или
http://localhost:8080/docs
```
