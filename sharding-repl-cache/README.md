# Задание 4. Решение кейса с кешированием

В проекте есть 2 шарда + 3 реплики в каждом шарде, 3 роутера и 3 конфига. Добавлен один сервис кеширования (моно, без кластера) -- redis. Настройки представлены в compose.yaml

## Как запустить

### Запускаем mongodb и приложение

```shell
docker compose build --no-cache
docker compose up -d
```

### Запустить настройку БД, наполнение документами. Скрипт:

```shell
./scripts/init.sh
```

В скрипте будут настроены роутеры, репликасеты шардов, конфиги. В конце выполнения скрипта будут показны результаты тестов: наличие реплик (что является primary, а что secondary для шардов), выведено количество документов в шардах, общее количество документов в БД, проверен доступ к API и проведены замеры скорости запросов с учетом кеширования.

Пример ответа:

```shell
...
[✔] Шарды добавлены и коллекция зашардирована
[...] Проверка количества документов в базе
Всего документов: 1000
[✔] Документы успешно подсчитаны
[...] Проверка shard1a
Количество документов в shard1a: 492
[✔] Shard1a проверен
[...] Проверка shard2a
Количество документов в shard2a: 508
[✔] Shard2a проверен
[...] Проверка доступности методов в http://localhost:8080/docs
Ответ от сервера: {"status":"OK","mongo_db":"somedb","items_count":1000}
[✔] Методы доступны, данные с БД можно получить
[...] Проверка реплик в первом шарде
Информация по первому шарду: shard1a:27018 — PRIMARY
shard1b:27018 — SECONDARY
shard1c:27018 — SECONDARY
[✔] ОК
[...] Проверка реплик во втором шарде
Информация по второму шарду: shard2a:27019 — PRIMARY
shard2b:27019 — SECONDARY
shard2c:27019 — SECONDARY
[✔] ОК
[✔] Финиш
```

```
[...] Проверка доступности методов в http://localhost:8080/docs
Ответ от сервера: {"status":"OK","mongo_db":"somedb","items_count":1000}
[✔] Методы доступны, данные с БД можно получить
```

Выведены результаты работы с кешем после пяти запросов.
Можно отдельно запустить скрипт ./scripts/speedtest.sh
```
[...] Запуск тестов скорости запросов с использованием кеша. Проверка GET-запроса: http://localhost:8080/helloDoc/users
[...] Попытка №1
[✔] Запрос успешен.
Время выполнения: 1.041455 сек
[...] Попытка №2
[✔] Запрос успешен.
Время выполнения: 0.007535 сек
[...] Попытка №3
[✔] Запрос успешен.
Время выполнения: 0.008479 сек
[...] Попытка №4
[✔] Запрос успешен.
Время выполнения: 0.007080 сек
[...] Попытка №5
[✔] Запрос успешен.
Время выполнения: 0.007719 сек
[✔] Финиш
```

## Проверка эндпойнтов

Узнать белый ip виртуальной машины

```shell
curl --silent http://ifconfig.me
```

Доступ к API-документации:

```
http://localhost:8080

http://<ip виртуальной машины>:8080/docs или http://localhost:8080/docs
```